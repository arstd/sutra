<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>阿弥陀佛</title>
    <style>
        body {
            font-weight: normal;
            font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
        }

        h3,
        h4 {
            text-align: center;
        }

        s {
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        s a {
            margin: 0 0.1rem;
            display: block;
            color: #c3c3c3;
        }

        s b {
            display: block;
        }

        .right {
            text-align: right;
        }

        select {
            font-size: inherit;
        }

        .hide {
            display: none;
        }

        .page {
            text-align: center;
            margin-top: 20px;
        }
        .page a {
            display: inline-block;
            margin: 0 5px;
            cursor: pointer;
            padding: 5px 10px;
        }
        .page a.gray {
            color: #a6a6a6;
            cursor: not-allowed;
        }
    </style>

    <script src="//cdn.bootcss.com/vue/2.1.10/vue.min.js"></script>
    <script src="//cdn.bootcss.com/axios/0.15.3/axios.min.js"></script>
    <!-- <script src="vue.min.js"></script>
    <script src="axios.min.js"></script> -->
</head>

<body>
    <div id="sutra">
        <div>
            <label for="select">选择经文：</label>
            <select id="select" v-model="name" @change="change">
                <option v-for="s in sutras" :value="s.name">{{s.title}}</option>
            </select>
            <input id="check" type="checkbox" v-model="show" v-bind:true-value="true" v-bind:false-value="false">
            <label for="check">显示拼音</label>
            <select v-model="per" @change="perChange">
                <option v-for="s in [1000,2000,3000,5000,10000]" :value="s">{{s}}</option>
            </select>
        </div>
        <h3>{{title}}<h3>
        <h4>{{alias}}</h4>
        <template v-for="(g, i) in content" :key="i">
            <br v-if="g.c==='\n'">
            <s v-else>
                <a :class="{'hide': !show}">{{g.p===g.c ? '' : g.p}}</a>
                <b>{{g.c}}</b>
            </s>
        </template>
        <div class="page">
            <a v-for="(v, i) in sections" :disabled="section>=i" :class="{'gray': section>=i}" @click="page(i)">{{i+1}}</a>
        </div>
    </div>

    <script>
    new Vue({
        el: '#sutra',
        data: {
            name: '',
            show: true,
            sutras: [
                {
                    "name": "dabfuz",
                    "title": "大悲咒"
                },{
                    "name": "dizwpusabmygjd",
                    "title": "地藏菩萨本愿经"
                },{
                    "name": "ggviyspusapummps",
                    "title": "观世音菩萨普门品"
                },{
                    "name": "jsgwjd",
                    "title": "金刚经"
                }
            ],
            title: '',
            alias: '',
            sections: [],
            groups: [],
            per: 1000,
            content: [],
            section: -1
        },
        mounted() {
            this.name = 'dabfuz'
            this.change()
        },
        methods: {
            page(i) {
                if (this.section >= i) return
                this.section = i
                this.content = this.groups.slice(0, this.per*(this.section+1))
            },
            perChange() {
                this.section = -1
                this.sections = new Array(Math.ceil(this.groups.length / this.per))
                this.page(0)
            },
            change() {
                axios.all([
                    axios.get(`data/${this.name}/info.json`),
                    axios.get(`data/${this.name}/chars.txt`),
                    axios.get(`data/${this.name}/pinyins.txt`)
                ]).then(axios.spread((info, chars, pinyins)=>{
                    this.title = info.data.title
                    this.alias = info.data.alias

                    this.section = -1
                    this.groups = []

                    let patt = /[a-zāáǎàēéěèīíǐìōóǒòūúǔùüǖǘǚǜA-Z]+/g
                    for (let c of chars.data) {
                        let g = { c: c, p: ''}

                        if (c >= '\u{4E00}' && c <= '\u{9FA5}') {
                            let m = patt.exec(pinyins.data)
                            if (m != null) {
                                g.p = m[0]
                            }
                        }
                        this.groups.push(g)
                    }

                    this.perChange()
                })).catch(err=>{
                    console.log(err)
                })
            }
        }
    })
    </script>
</body>

</html>
